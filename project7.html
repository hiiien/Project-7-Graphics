<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title></title>
	<style>
		body {
			margin: 0;
			padding: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			background-color: dimgrey;
		}

		canvas {
			border: 1px solid black;
		}
	</style>

	<!-- Vertex Shader (WebGL2 / GLSL ES 3.00) -->
	<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es
precision highp float;

in vec3 a_position;
in vec3 a_color;
in vec2 a_texCoord;

uniform mat4 u_modelViewMatrix;
uniform mat4 u_projectionMatrix;

out vec3 v_color;
out vec3 v_fragPos;   
out vec2 v_texCoord;

void main() {
    vec4 viewPos = u_modelViewMatrix * vec4(a_position, 1.0);
    v_fragPos = viewPos.xyz;
    v_color = a_color;

    gl_Position = u_projectionMatrix * viewPos;
    v_texCoord = a_texCoord;
}
  </script>

	<!-- Fragment Shader (WebGL2 / GLSL ES 3.00) -->
	<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es
precision highp float;

in vec3 v_color;
in vec3 v_fragPos;
in vec2 v_texCoord;

uniform vec3 u_lightPosView;  
uniform int  u_isLight;      
uniform sampler2D u_texture;

out vec4 outColor;

void main() {
    if (u_isLight == 1) {
        outColor = vec4(1.2, 1.2, 1.2, 1.0);  
        return;
    }

    vec3 dx = dFdx(v_fragPos);
    vec3 dy = dFdy(v_fragPos);
    vec3 normal = normalize(cross(dx, dy));

    vec3 toLight = u_lightPosView - v_fragPos;
    float dist   = length(toLight);

    vec3 lightDir = dist > 0.0 ? toLight / dist : vec3(0.0, 0.0, 0.0);

    float diff = max(dot(normal, lightDir), 0.0);

    float constant  = 1.0;
    float linear    = 0.2;
    float quadratic = 0.1;

    float attenuation = 1.0 / (constant + linear * dist + quadratic * dist * dist);

    vec3 baseColor = v_color;

    vec3 ambient = 0.15 * baseColor;                    // soft base light
    vec3 diffuse = diff * baseColor * attenuation;      // fades with distance

    vec4 texColor = texture(u_texture, v_texCoord);
    outColor = vec4(ambient + diffuse, 1.0) * texColor;
}
</script>
</head>

<body>
	<canvas id="canvas" width="500" height="500"></canvas>
</body>

<script src="project7.js"></script>

</html>
